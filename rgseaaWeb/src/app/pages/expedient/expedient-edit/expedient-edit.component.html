
<form [formGroup]="form">

    <tsw-form-container>

        <tsw-section-wrapper class="mb-5" icon="edit_note">

            <div section-content>
                <div class="flex justify-end">
                    <h1 class="text-3xl">EXPEDIENTE</h1>
                </div>
            </div>

            <div section-content>

                <div class="flex justify-end">
                    <div matTooltip="Regresar">
                        <a
                            mat-icon-button color="primary"
                            [routerLink]="'industryManagementEdit' | namedRoute: {id: this._idIndustry }">
                            <mat-icon>keyboard_return</mat-icon>
                        </a>
                    </div>

                </div>

            </div>

            <div section-content>

                <h1 class="text-2xl">Datos Genericos</h1>
                <br/>

                <div class="flex flex-row gap-1.5">

                    <mat-form-field class="w-30">
                        <mat-label></mat-label>
                        <tsw-custom-select
                            resourceName="expedientsType"
                        ></tsw-custom-select>
                    </mat-form-field>

                    <mat-form-field class="w-30">
                        <mat-label>Nº Expediente</mat-label>
                        <input matInput formControlName="numberExpedient" >
                    </mat-form-field>

                    <div class="w-20"></div>

                    <mat-form-field class="w-14">
                        <mat-label>KEY</mat-label>
                        <mat-select formControlName="key" (selectionChange)="changeKey()">
                            <mat-option *ngFor="let key of keyIndustry" [value]="key">
                                {{key.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <mat-form-field class="w-30">
                        <mat-label></mat-label>
                        <input matInput formControlName="numberIndustry">
                    </mat-form-field>

                    <mat-form-field class="w-12">
                        <mat-label></mat-label>
                        <input matInput formControlName="enrollment">
                    </mat-form-field>

                    <div class="w-20"></div>

                    <mat-form-field class="w-30">
                        <mat-label>Situacion Expe</mat-label>
                        <tsw-custom-select
                            resourceName="productsSituations"
                            formControlName="situation"
                        ></tsw-custom-select>
                    </mat-form-field>
                </div>


                <div class="flex gap-1.5">
                    Procedimiento:
                    <mat-radio-group aria-label="Select an option">
                        <mat-radio-button value="1">Flujo Manual&nbsp;&nbsp;</mat-radio-button>
                        <mat-radio-button value="2">Flujo Electrónico</mat-radio-button>
                    </mat-radio-group>
                </div>


                <div class="flex gap-1.5">

                    <mat-form-field class="basis-1/4">
                        <mat-label>Fecha Anotación</mat-label>
                        <input matInput [matDatepicker]="picker5" formControlName="dateInspection">
                        <mat-hint>MM/DD/YYYY</mat-hint>
                        <mat-datepicker-toggle matSuffix [for]="picker5"></mat-datepicker-toggle>
                        <mat-datepicker #picker5></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field class="basis-1/4">
                        <mat-label>Fecha solicitud AESAN</mat-label>
                        <input matInput [matDatepicker]="picker6" formControlName="dateRequestChange">
                        <mat-hint>MM/DD/YYYY</mat-hint>
                        <mat-datepicker-toggle matSuffix [for]="picker6"></mat-datepicker-toggle>
                        <mat-datepicker #picker6></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field class="basis-1/4">
                        <mat-label>Fecha respuesta SOLICITANTE</mat-label>
                        <input matInput [matDatepicker]="picker7" formControlName="dateLastRequest">
                        <mat-hint>MM/DD/YYYY</mat-hint>
                        <mat-datepicker-toggle matSuffix [for]="picker7"></mat-datepicker-toggle>
                        <mat-datepicker #picker7></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field class="basis-1/4">
                        <mat-label>Fecha informe AESAN-RN</mat-label>
                        <input matInput [matDatepicker]="picker8" formControlName="dateReport">
                        <mat-hint>MM/DD/YYYY</mat-hint>
                        <mat-datepicker-toggle matSuffix [for]="picker8"></mat-datepicker-toggle>
                        <mat-datepicker #picker8></mat-datepicker>
                    </mat-form-field>
                </div>


                <div class="flex gap-1.5">
                    <mat-form-field class="basis-full">
                        <mat-label>Area</mat-label>
                        <input matInput>
                    </mat-form-field>
                </div>

            </div>

        </tsw-section-wrapper>

    </tsw-form-container>



    <tsw-form-container>

        <tsw-section-wrapper class="mb-5" icon="edit_note">

            <div section-content>
                <h1 class="text-2xl">Datos de Producto</h1>
                <br/>
                <div class="flex gap-1.5">
                    <mat-form-field class="basis-6/12" >
                        <mat-label>Razón Social (Empresa responsable de la comercialización)</mat-label>
                        <input matInput formControlName="nameBusiness">
                    </mat-form-field>

                    <mat-form-field class="basis-6/12">
                        <mat-label>Domicilio Empresa(Domicilio Social)</mat-label>
                        <input matInput formControlName="addressBusiness">
                    </mat-form-field>
                </div>

                <div class="flex gap-1.5">
                    <mat-form-field class="basis-6/12" >
                        <mat-label>Teléfono de contacto</mat-label>
                        <input matInput formControlName="industryPhone">
                    </mat-form-field>

                    <mat-form-field class="basis-6/12">
                        <mat-label>Correo Electrónico</mat-label>
                        <input matInput formControlName="emailResponsible">
                    </mat-form-field>
                </div>


                <div class="flex gap-1.5">
                    <mat-form-field class="basis-1/4">
                        <mat-label>País</mat-label>
                        <tsw-custom-select
                            resourceName="productsCountries" formControlName="country"
                        ></tsw-custom-select>
                    </mat-form-field>

                    <mat-form-field class="basis-1/4">
                        <mat-label>Denominación de venta </mat-label>
                        <tsw-custom-select
                            resourceName="productsDenominationSales"
                            formControlName="denominationSale"
                        ></tsw-custom-select>
                    </mat-form-field>
                </div>

                <div class="flex gap-1.5">
                    <mat-form-field class="basis-full">
                        <mat-label>Nombre comercial</mat-label>
                        <input matInput formControlName="brand">
                    </mat-form-field>
                </div>

                <div class="flex gap-1.5">
                    <mat-form-field  class="basis-full">
                        <mat-label>Observaciones</mat-label>
                        <textarea  matInput rows="5" formControlName="observation"></textarea>
                    </mat-form-field>
                </div>
            </div>
        </tsw-section-wrapper>
    </tsw-form-container>


    <tsw-form-container>
        <tsw-section-wrapper class="mb-5" icon="edit_note">

            <div section-content>
                <h1 class="text-2xl">Información Adicional Clave 26</h1>
                <br/>

                <div class="flex gap-1.5">
                    <mat-form-field class="basis-2/6">
                        <mat-label>País donde se fabrica</mat-label>
                        <tsw-custom-select
                            resourceName="productsCountries"
                            formControlName="countryFabrication"
                        ></tsw-custom-select>
                    </mat-form-field>

                    <mat-form-field class="basis-2/6">
                        <mat-label>País donde se ha comercializado </mat-label>
                        <tsw-custom-select
                            resourceName="productsCountries"
                            formControlName="countryCommercialization"
                        ></tsw-custom-select>
                    </mat-form-field>

                    <mat-form-field class="basis-2/6">
                        <mat-label>País de comercialización fuera de la UE</mat-label>
                        <input matInput formControlName="otherCountry">
                    </mat-form-field>
                </div>


                <div class="flex gap-1.5">

                    <mat-form-field class="basis-1/2">
                        <mat-label>Forma de Presentación</mat-label>
                        <tsw-custom-select
                            resourceName="productsPresentation"
                            formControlName="formPresentation"
                        ></tsw-custom-select>
                    </mat-form-field>

                    <mat-form-field class="basis-1/2">
                        <mat-label>Otras formas de presentación</mat-label>
                        <input matInput formControlName="otherForms">
                    </mat-form-field>
                </div>


                <div class="flex gap-1.5">
                    <mat-form-field  class="basis-full">
                        <mat-label>Ingredientes</mat-label>
                        <textarea  matInput rows="5" formControlName="ingredient"></textarea>
                    </mat-form-field>
                </div>

                <div class="flex gap-1.5">
                    <mat-form-field class="basis-1/2">
                        <mat-label>Tipo de Envase</mat-label>
                        <input matInput formControlName="typeContainer">
                    </mat-form-field>

                    <mat-form-field class="basis-1/2">
                        <mat-label>Tipo sustancia con efecto fisiológico o nutricional</mat-label>
                        <input matInput>
                    </mat-form-field>
                </div>

                <div class="flex gap-1.5">
                    <mat-form-field class="basis-full">
                        <mat-label>Razón Social (Titular distinto)</mat-label>
                        <input matInput formControlName="socialReasonKey26">
                    </mat-form-field>
                </div>

                <div class="flex gap-1.5">

                    <mat-form-field class="basis-2/6">
                        <mat-label>País donde se ha comercializado </mat-label>
                        <tsw-custom-select
                            formControlName="countryIaKey26"
                            resourceName="productsCountries"
                        ></tsw-custom-select>
                    </mat-form-field>

                    <mat-form-field class="basis-4/6">
                        <mat-label>Domicilio (Titular Distinto)</mat-label>
                        <input matInput formControlName="addressKey26">
                    </mat-form-field>

                </div>


                <div class="flex gap-1.5">
                    <mat-form-field  class="basis-full">
                        <mat-label>Nombre del Producto (Titular Distinto)</mat-label>
                        <input matInput formControlName="productNameIaKey26">
                    </mat-form-field>
                </div>


                <div class="flex gap-1.5">

                    <mat-form-field  class="basis-2/4">
                        <mat-label>Correo Electrónico (Titular Distinto)</mat-label>
                        <input matInput formControlName="emailKey26">
                    </mat-form-field>

                    <mat-form-field  class="basis-2/4">
                        <mat-label>Teléfono de contacto (Titular Distinto)</mat-label>
                        <input matInput formControlName="phoneIaCode26">
                    </mat-form-field>
                </div>


                <div class="flex gap-1.5">

                    <mat-form-field class="basis-1/4">
                        <mat-label>Fecha Entrada</mat-label>
                        <input matInput [matDatepicker]="picker1" formControlName="dateAdmission">
                        <mat-hint>MM/DD/YYYY</mat-hint>
                        <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                        <mat-datepicker #picker1></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field class="basis-1/4">
                        <mat-label>Fecha Estimada Resolución</mat-label>
                        <input matInput [matDatepicker]="picker2" formControlName="dateEstiResolution">
                        <mat-hint>MM/DD/YYYY</mat-hint>
                        <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                        <mat-datepicker #picker2></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field class="basis-1/4">
                        <mat-label>Fecha Denegación</mat-label>
                        <input matInput [matDatepicker]="picker3" formControlName="dateOfDenial">
                        <mat-hint>MM/DD/YYYY</mat-hint>
                        <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
                        <mat-datepicker #picker3></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field class="basis-1/4">
                        <mat-label>Fecha Respuesta AESAN</mat-label>
                        <input matInput [matDatepicker]="picker4" formControlName="dateResponseAesan">
                        <mat-hint>MM/DD/YYYY</mat-hint>
                        <mat-datepicker-toggle matSuffix [for]="picker4"></mat-datepicker-toggle>
                        <mat-datepicker #picker4></mat-datepicker>
                    </mat-form-field>
                </div>

            </div>
        </tsw-section-wrapper>
    </tsw-form-container>


    <tsw-form-container>
        <tsw-section-wrapper class="mb-5" icon="edit_note">
            <div section-content>
                <h1 class="text-2xl">Actividades / Categorías</h1>
                <br/>
                <div class="flex flex-row gap-1.5">

                    <mat-form-field class="basis-1/3">
                        <mat-label>Actividad</mat-label>
                        <mat-select formControlName="activity" (selectionChange)="changeActivity()">
                            <mat-option *ngFor="let item of activityIndustry" [value]="item">
                                {{item.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <mat-form-field class="basis-1/3">
                        <mat-label>Categoria</mat-label>
                        <mat-select formControlName="category"  (selectionChange)="changeCategory()">
                            <mat-option *ngFor="let item of categoryIndustry" [value]="item">
                                {{item.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>


                    <mat-form-field class="basis-1/3">
                        <mat-label>Subactividad</mat-label>
                        <mat-select formControlName="subactivity">
                            <mat-option *ngFor="let item of subactivityIndustry" [value]="item">
                                {{item.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                </div>


                <div class="flex flex-row gap-1.5">
                    <button mat-raised-button (click)="addActivity()" [disabled]="!disabledButonAddActity" >Introducir</button>
                </div>

                <br>

                <div class="grid grid-cols-1 gap-1.5">

                    <table #tableActivity mat-table [dataSource]="dataSourceACS" class="mat-elevation-z8 demo-table">
                        <!-- Position Column -->
                        <ng-container matColumnDef="activity">
                            <th mat-header-cell *matHeaderCellDef> Actividades </th>
                            <td mat-cell *matCellDef="let element"> {{element.activity.name}} </td>
                        </ng-container>

                        <!-- Name Column -->
                        <ng-container matColumnDef="category">
                            <th mat-header-cell *matHeaderCellDef> Categorias </th>
                            <td mat-cell *matCellDef="let element"> {{element.category.name}} </td>
                        </ng-container>

                        <!-- Weight Column -->
                        <ng-container matColumnDef="subactivity">
                            <th mat-header-cell *matHeaderCellDef> Subactividades </th>
                            <td mat-cell *matCellDef="let element"> {{element.subActivity.name}} </td>
                        </ng-container>

                        <ng-container matColumnDef="delete">
                            <th mat-header-cell *matHeaderCellDef> Eliminar </th>
                            <td mat-cell *matCellDef="let element">
                                <button mat-mini-fab color="warn" (click)="deleteActivityRow(element.count)">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>
                </div>

            </div>
        </tsw-section-wrapper>
    </tsw-form-container>

    <tsw-form-container>
        <tsw-section-wrapper class="mb-5" icon="edit_note">
            <div section-content>
                <h1 class="text-2xl">Actuaciones/ Documentos</h1>
                <br/>

                <div class="flex flex-row gap-1.5" *ngIf="!isNew">

                    <mat-form-field class="basis-2/4">
                        <mat-label>Tipo Actuación</mat-label>
                        <tsw-custom-select
                            resourceName="productTypeAction"
                            formControlName="typeAction"
                        ></tsw-custom-select>
                    </mat-form-field>

                    <div class="basis-1/4">
                        <button mat-raised-button color="primary" (click)="addRow()">Añadir</button>
                    </div>

                </div>

                <div class="grid grid-cols-1 gap-1.5">

                    <table mat-table #table1 [dataSource]="dataSource" class="mat-elevation-z8 demo-table">

                        <!-- Position Column -->
                        <ng-container matColumnDef="date">
                            <th mat-header-cell *matHeaderCellDef> Fecha </th>
                            <td mat-cell *matCellDef="let element">{{element.id}}</td>
                        </ng-container>


                        <!-- Name Column -->
                        <ng-container matColumnDef="type-name">
                            <th mat-header-cell *matHeaderCellDef> Tipo </th>
                            <td mat-cell *matCellDef="let element">{{element.typeAction.name}}</td>
                        </ng-container>


                        <!-- Weight Column -->
                        <ng-container matColumnDef="description">
                            <th mat-header-cell *matHeaderCellDef> Descripción </th>
                            <td mat-cell *matCellDef="let element">  </td>
                        </ng-container>


                        <!-- Symbol Column -->
                        <ng-container matColumnDef="files">
                            <th mat-header-cell *matHeaderCellDef> Fichero </th>
                            <td mat-cell *matCellDef="let element">  </td>
                        </ng-container>


                        <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef> Acciones </th>

                            <td mat-cell *matCellDef="let element">

                                <div *ngIf="element.typeAction.id==21">
                                    <button mat-mini-fab color="primary" (click)="openDialog(element.id)">
                                        <mat-icon>attach_file</mat-icon>
                                    </button>
                                </div>

                                <div *ngIf="element.typeAction.id!=21">
                                    <button mat-mini-fab color="primary" (click)="openDialog(element.id)">
                                        <mat-icon>attach_file</mat-icon>
                                    </button>
                                    <button mat-mini-fab color="warn" (click)="deleteRow(element.id)">
                                        <mat-icon>delete</mat-icon>
                                    </button>
                                </div>

                            </td>

                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumnsActuation"></tr>

                        <tr mat-row *matRowDef="let row; columns: displayedColumnsActuation;" [hidden]="row.update === 1"></tr>

                    </table>

                </div>


            </div>
        </tsw-section-wrapper>

        <tsw-form-actions
            [saveBtnSkipConfirmation]="skipSaveConfirmation"
            (reset)="resetForm()"
            (save)="submitForm()"
        ></tsw-form-actions>

    </tsw-form-container>

</form>
